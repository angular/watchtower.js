{"version":3,"file":"watch_record.js","sources":["watch_record.js","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/15","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/17","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/16"],"names":[],"mappings":"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","sourcesContent":["import {\n  _LinkedList,\n  _LinkedListItem,\n  _WatchList,\n  _ArgHandlerList,\n  _EvalWatchList\n} from './linked_list';\n\nimport {\n  Watch\n} from './watch';\n\nvar haveMap = (typeof WeakMap === \"function\" && typeof Map === \"function\");\n\nclass _Handler {\n  constructor(watchGrp, expression) {\n    _LinkedList._initialize(this);\n    _LinkedListItem._initialize(this);\n    _WatchList._initialize(this);\n\n    this.watchGrp = watchGrp;\n    this.expression = expression;\n    this.watchRecord = this.forwardingHandler = null;\n  }\n\n  addReactionFn(reactionFn) {\n    // TODO: Traceur assertions\n    // assert(this._next !== this);\n    // assert(typeof reactionFn === \"function\");\n    return this.watchGrp._rootGroup._addDirtyWatch(_WatchList._add(this,\n      new Watch(this.watchGrp, this.watchRecord, reactionFn)));\n  }\n\n  addForwardHandler(forwardToHandler) {\n    // TODO: Traceur assertions\n    // assert(forwardToHandler.forwardingHandler === null);\n    _LinkedList._add(this, forwardToHandler);\n    forwardToHandler.forwardingHandler = this;\n  }\n\n  // I'm not sure this really makes sense in JS, since we don't actually know when finallization\n  // occurs. I think this is called manually in a few areas though, so I'll leave it for now.\n  release() {\n    if (_WatchList._isEmpty(this) && _LinkedList._isEmpty(this)) {\n      this._releaseWatch();\n\n      // Remove outselves from cache, or else new registrations will go to us, but we are dead\n      // Potential GC pressure...\n      if (this.watchGrp) {\n        delete this.watchGrp._cache[this.expression];\n      }\n\n      if (this.forwardingHandler !== null) {\n        // TODO(misko): why do we need this check? --- Because _LinkedList._remove() manipulates\n        // properties of the list, and it will be referencing properties of null and throw a\n        // noSuchMethod error if forwardingHandler === null\n        _LinkedList._remove(this.forwardingHandler, this);\n        this.forwardingHandler.release();\n        this.forwardingHandler = null;\n      }\n\n      // We can remove ourselves\n      this._next = this._previous = this;\n    }\n  }\n\n  _releaseWatch() {\n    this.watchRecord.remove();\n    this.watchGrp._fieldCost--;\n  }\n\n  acceptValue(object) {\n    return null;\n  }\n\n  onChange(record) {\n    // TODO: Traceur assertions\n    // assert(this._next !== this); // Verify we are not detached\n\n    // If we have reaction functions, then queue them up for asynchronous processing.\n    var watch = this._watchHead;\n    var root = this.watchGrp._rootGroup;\n    while (watch !== null) {\n      root._addDirtyWatch(watch);\n      watch = watch._nextWatch;\n    }\n\n    // If we have a delegateHandler, then forward the new value to it.\n    var delegateHandler = this._head;\n    while (delegateHandler !== null) {\n      delegateHandler.acceptValue(record.currentValue);\n      delegateHandler = delegateHandler._next;\n    }\n  }\n}\n\nexport class _ConstantHandler extends _Handler {\n  constructor(watchGroup, expression, constantValue) {\n    super(watchGroup, expression);\n    this.watchRecord = new _EvalWatchRecord.constant(this, constantValue);\n  }\n\n  release() {\n    return null;\n  }\n}\n\nexport class _FieldHandler extends _Handler {\n  constructor(watchGroup, expression) {\n    super(watchGroup, expression);\n  }\n\n  // This function forwards the watched object to the next [_Handler] synchronously\n  acceptValue(object) {\n    this.watchRecord.object = object;\n    if (this.watchRecord.check()) this.onChange(this.watchRecord);\n  }\n}\n\nexport class _CollectionHandler extends _Handler {\n  constructor(watchGroup, expression) {\n    super(watchGroup, expression);\n  }\n\n  // This function forwards the watched object to the next [_Handler] synchronously\n  acceptValue(object) {\n    this.watchRecord.object = object;\n    if (this.watchRecord.check()) this.onChange(this.watchRecord);\n  }\n\n  _releaseWatch() {\n    this.watchRecord.remove();\n    this.watchGrp._collectionCost--;\n  }\n}\n\nexport class _ArgHandler extends _Handler {\n  constructor(watchGroup, watchRecord, index) {\n    // TODO(caitp): assert that watchRecord is an _EvalWatchRecord?\n    super(watchGroup, 'arg[' + index + ']');\n    this._previousArgHandler = this._nextArgHandler = null;\n    this.watchRecord = watchRecord;\n    this.index = index;\n  }\n\n  _releaseWatch() {\n    return null;\n  }\n\n  acceptValue(object) {\n    this.watchRecord.dirtyArgs = true;\n    this.watchRecord.args[this.index] = object;\n  }\n}\n\nexport class _InvokeHandler extends _Handler {\n  constructor(watchGroup, expression) {\n    super(watchGroup, expression);\n    _ArgHandlerList._initialize(this);\n  }\n\n  acceptValue(object) {\n    this.watchRecord.object = object;\n  }\n\n  release() {\n    super.release();\n    var current = this._argHandlerHead;\n    while (current !== null) {\n      current.release();\n      current = current._nextArgHandler;\n    }\n    // TODO(caitp): should _argHandlerHead/Tail be nulled here? Or would that cause too much GC\n    // pressure.\n  }\n\n  _releaseWatch() {\n    this.watchRecord.remove();\n    // TODO(caitp): why return undefined here?\n  }\n}\n\nvar _MODE_DELETED_ = -1;\nvar _MODE_MARKER_ = 0;\nvar _MODE_FUNCTION_ = 1;\nvar _MODE_FUNCTION_APPLY_ = 2;\nvar _MODE_NULL_ = 3;\nvar _MODE_FIELD_CLOSURE_ = 4;\nvar _MODE_MAP_CLOSURE_ = 5;\nvar _MODE_METHOD_ = 6;\n\n// TODO(caitp): This does not seem like the correct module for _EvalWatchRecord to live\nexport class _EvalWatchRecord {\n  constructor(watchGrp, handler, fn, name, arity, marker) {\n    this.watchGrp = watchGrp;\n    this.handler = handler;\n    this.name = name;\n    this.fn = fn;\n    // TODO(caitp): The ES6 draft is not super clear about what can be done with Symbols.\n    // This may be entirely unnecessary.\n    // this.symbol = name === null ? null : new Symbol(name);\n    this._prevEvalWatch = this._nextEvalWatch = null;\n\n    if (marker === true) return;\n    this.args = new Array(arity);\n\n    // TODO(caitp): Does the FunctionApply type really need to be implemented?\n    if (typeof fn === 'function') {\n      this.mode = _MODE_FUNCTION_;\n    } else {\n      this.mode = _MODE_NULL_;\n    }\n  }\n\n  static marker() {\n    var record = new _EvalWatchRecord(null, null, null, null, null, true);\n    record.args = null;\n    record.mode = _MODE_MARKER_;\n    return record;\n  }\n\n  static constant(handler, constantValue) {\n    var record = _EvalWatchRecord.marker();\n    record.currentValue = constantValue;\n    record.handler = handler;\n    return record;\n  }\n\n  get field() {\n    // TODO(caitp): does this look right for javascript? Some other representation might make more\n    // sense.\n    return '()';\n  }\n\n  get object() {\n    return this._object;\n  }\n\n  set object(value) {\n    // TODO(caitp): Traceur assertions\n    // assert(this.mode !== _MODE_DeLETED_);\n    // assert(this.mode !== _MODE_MARKER_);\n    // assert(this.mode !== _MODE_FUNCTION_);\n    // assert(this.mode !== _MODE_FUNCTION_APPLY_);\n    // assert(this.symbol !== null);\n    this._object = value;\n\n    if (value === null) {\n      this.mode = _MODE_NULL_;\n    } else {\n      if (haveMap && (value instanceof Map || value instanceof WeakMap)) {\n        this.mode = _MODE_MAP_CLOSURE_;\n      } else if (this.name) {\n        this.mode = _MODE_METHOD_;\n      }\n    }\n    /**\n     * TODO(caitp): The usefulness of these blocks is yet to be discovered, but I'm sure it's out\n     * there somewhere.\n     *\n     * else {\n     *   if (value instanceof Map) {\n     *     this.mode = _MODE_MAP_CLOSURE_;\n     *   } else {\n     *     this._instanceMirror = this.reflect(value);\n     *     this.mode = this._hasMethod(this._instanceMirror, this.symbol)\n     *               ? _MODE_METHOD_\n     *               : _MODE_FIELD_CLOSURE_;\n     *   }\n     * }\n     */\n  }\n\n  check() {\n    var value;\n    switch (this.mode) {\n    case _MODE_MARKER_:\n    case _MODE_NULL_:\n      return false;\n    case _MODE_FUNCTION_:\n      if (!this.dirtyArgs) return false;\n      value = this.fn.apply(null, this.args);\n      this.dirtyArgs = false;\n      break;\n    case _MODE_METHOD_:\n      value = methodInvoke(this._object, this.name, this.args);\n      break;\n    // TODO: the rest of these items don't really make sense in JS, as far as I can tell.\n    // Investigate and ask about this.\n    default:\n      throw \"UNREACHABLE\";\n    }\n\n    var current = this.currentValue;\n    if (current !== value) {\n      if (current !== current && value !== value) {\n        // Ignore, it appears to be a NaN -> NaN change.\n        current = value;\n      } else {\n        this.previousValue = current;\n        this.currentValue = value;\n        this.handler.onChange(this);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  get nextChange() {\n    // TODO(caitp): Investigate this, it doesn't seem to make a lot of sense. Is this because it\n    // lives in the evalWatchList rather than a different sort of list?\n    return null;\n  }\n\n  remove() {\n    // TODO(caitp): Traceur assertions\n    // assert(this.mode !== _MODE_DELETED_);\n    this.mode = _MODE_DELETED_;\n    this.watchGrp._evalCost--;\n    _EvalWatchList._remove(this.watchGrp, this);\n  }\n\n  toString() {\n    if (this.mode === _MODE_MARKER_) return 'MARKER[' + this.currentValue + ']';\n    return '' + this.watchGrp.id + ':' + this.handler.expression;\n  }\n\n  // TODO(caitp): worry about this later...\n  // static _hasMethod(mirror, symbol) {\n  //   return mirror.type.instanceMembers[symbol] is MethodMirror;\n  // }\n}\n\nvar __no_args__ = [];\nfunction methodInvoke(object, method, args) {\n  if (object || (typeof object !== 'undefined' && object !== null)) {\n    if (typeof object[method] === \"function\") {\n      return object[method].apply(object, args || __no_args__);\n    }\n  }\n}\n","var __moduleName = $__placeholder__0;","require($__placeholder__0)","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2)","$traceurRuntime.superCall($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                   $__placeholder__3)","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)","module.exports = $__placeholder__0;","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true"]}